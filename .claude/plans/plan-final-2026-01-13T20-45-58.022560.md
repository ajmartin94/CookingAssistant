# Plan (FINAL)

**Timestamp:** 2026-01-13T20:45:58.023067

# E2E Testing Implementation Plan - Playwright

**Goal**: Implement browser-based End-to-End testing to catch server errors, API errors, database issues, and user workflow problems that current unit/integration tests miss.

**Framework**: Playwright (TypeScript, cross-browser)
**Coverage**: Critical paths (auth, recipe CRUD, major workflows)
**CI/CD**: Run on every PR
**Estimated Time**: ~26 hours

---

## Current Testing Gaps

### What's Missing
- ❌ **No actual server startup** - Tests use in-memory SQLite and mocked HTTP
- ❌ **No real API integration** - MSW mocks all frontend API calls
- ❌ **No browser automation** - Tests run in jsdom only
- ❌ **No E2E user journeys** - Multi-step workflows untested
- ❌ **No real error scenarios** - Server/API errors not caught in production-like environment

### What Exists (Strong Foundation)
- ✅ 352 tests (98.9% pass rate)
- ✅ Backend: 147 tests (pytest, 78% coverage)
- ✅ Frontend: 205 tests (Vitest + RTL + MSW)
- ✅ Service layer: 100% coverage

---

## Implementation Phases

### Phase 1: Project Setup (3 hours)

**1.1 Install Playwright**
```bash
npm init playwright@latest
```
- Choose TypeScript, test folder: `e2e/tests`, install browsers

**1.2 Create Configuration**
- **File**: `playwright.config.ts`
- **Purpose**: Configure browser projects, server startup, reporting
- **Key Features**:
  - Start backend (FastAPI port 8000) and frontend (Vite port 5173) before tests
  - Use test database: `cooking_assistant_test_e2e.db`
  - Run tests across Chrome, Firefox, Safari
  - Generate HTML reports, traces on failure

**1.3 Global Setup/Teardown**
- **File**: `e2e/global-setup.ts`
  - Wait for backend health check: `http://localhost:8000/api/v1/health`
  - Wait for frontend: `http://localhost:5173`
  - Clean old test database
- **File**: `e2e/global-teardown.ts`
  - Remove test database after all tests

**1.4 Directory Structure**
```
e2e/
├── tests/
│   ├── auth/           # register, login, logout tests
│   ├── recipes/        # CRUD tests
│   ├── workflows/      # complete user journeys
│   └── errors/         # error scenarios
├── pages/              # Page Object Models
├── fixtures/           # Test fixtures (auth, data)
├── utils/              # Helpers (API, test data)
└── reports/            # Test results (gitignored)
```

**1.5 Update .gitignore**
```
e2e/reports/
e2e/test-results/
cooking_assistant_test_e2e.db
```

---

### Phase 2: Test Infrastructure (8 hours)

**2.1 Base Page Object**
- **File**: `e2e/pages/base.page.ts`
- **Purpose**: Common page functionality (navigation, waiting, error handling)
- **Methods**: `goto()`, `waitForPageLoad()`, `getAuthToken()`, `setAuthToken()`, `clearAuth()`

**2.2 Page Object Models**
Create page objects for each major page:
- `e2e/pages/login.page.ts` - Login form interactions
- `e2e/pages/register.page.ts` - Registration form
- `e2e/pages/recipes.page.ts` - Recipe list, search, create button
- `e2e/pages/create-recipe.page.ts` - Recipe creation form
- `e2e/pages/recipe-detail.page.ts` - Recipe detail view, edit/delete

**2.3 Authentication Fixture**
- **File**: `e2e/fixtures/auth.fixture.ts`
- **Purpose**: Provide pre-authenticated page context
- **Features**:
  - `testUser` - Unique user credentials for each test
  - `authenticatedPage` - Page with valid auth token
  - Automatic registration and login before tests

**2.4 Test Utilities**
- `e2e/utils/api.ts` - Direct API calls (register, login, create recipe, delete)
- `e2e/utils/test-data.ts` - Generate unique usernames, emails, recipe data
- `e2e/utils/database.ts` - Database cleanup helpers (if needed)

---

### Phase 3: Critical Path Tests (11 hours)

**3.1 Authentication Tests (3 hours)**

`e2e/tests/auth/register.spec.ts`:
- ✅ Register new user successfully
- ✅ Show error for duplicate username/email
- ✅ Validate password requirements
- ✅ Redirect to recipes page after registration
- ✅ Store auth token in localStorage

`e2e/tests/auth/login.spec.ts`:
- ✅ Login with valid credentials
- ✅ Show error for invalid credentials
- ✅ Persist authentication after page refresh
- ✅ Redirect to recipes page

`e2e/tests/auth/logout.spec.ts`:
- ✅ Logout successfully
- ✅ Clear auth token
- ✅ Redirect to login when accessing protected route after logout

**3.2 Recipe CRUD Tests (4 hours)**

`e2e/tests/recipes/create.spec.ts`:
- ✅ Create recipe with all fields
- ✅ Validate required fields (title, ingredients, instructions)
- ✅ Persist recipe to database (verify in new session)
- ✅ Redirect to recipe detail page

`e2e/tests/recipes/list.spec.ts`:
- ✅ Display user's recipes
- ✅ Search recipes by title
- ✅ Filter by cuisine, difficulty, dietary tags
- ✅ Paginate through recipes

`e2e/tests/recipes/detail.spec.ts`:
- ✅ Display all recipe fields
- ✅ Show ingredients and instructions
- ✅ Handle non-existent recipe (404)
- ✅ Show edit/delete buttons for owner only

`e2e/tests/recipes/edit.spec.ts`:
- ✅ Update recipe title and description
- ✅ Modify ingredients and instructions
- ✅ Persist changes to database
- ✅ Redirect to detail page

`e2e/tests/recipes/delete.spec.ts`:
- ✅ Delete recipe successfully
- ✅ Show confirmation dialog
- ✅ Remove from database (verify in list)
- ✅ Redirect to recipes list

**3.3 Complete User Journey (2 hours)**

`e2e/tests/workflows/complete-recipe-journey.spec.ts`:
- ✅ Register → Login → Create Recipe → View → Edit → Delete → Logout
- **Purpose**: Ensure multi-step workflows work end-to-end
- **Validates**: Navigation, state persistence, database operations

**3.4 Error Scenarios (2 hours)**

`e2e/tests/errors/network-errors.spec.ts`:
- ✅ Handle API timeout gracefully
- ✅ Display error message on 500 server error
- ✅ Retry failed requests (if implemented)

`e2e/tests/errors/validation-errors.spec.ts`:
- ✅ Show validation errors for empty fields
- ✅ Validate ingredient/instruction requirements
- ✅ Display user-friendly error messages

---

### Phase 4: CI/CD Integration (2.5 hours)

**4.1 GitHub Actions Workflow**
- **File**: `.github/workflows/e2e-tests.yml`
- **Triggers**: Push to main/develop/claude/**, PRs to main/develop
- **Strategy**: Matrix testing (chromium, firefox)
- **Steps**:
  1. Checkout code
  2. Setup Node.js 20 + Python 3.11
  3. Install backend dependencies
  4. Install frontend dependencies
  5. Install Playwright browsers
  6. Run E2E tests
  7. Upload test results, videos, traces on failure

**4.2 Test Artifacts**
- HTML reports (7-day retention)
- Videos (on failure)
- Traces (on failure)
- JUnit XML (for CI integration)

---

### Phase 5: Documentation (1.5 hours)

**5.1 Create E2E Testing Guide**
- **File**: `docs/E2E_TESTING.md`
- **Contents**:
  - How to run tests locally
  - How to debug failing tests
  - How to write new tests
  - Page Object Model patterns
  - Best practices (avoid flaky tests)

**5.2 Update Existing Docs**
- `README.md` - Add E2E testing section
- `docs/TESTING.md` - Add E2E test statistics

---

## Critical Files to Create

### Configuration (3 files)
1. `playwright.config.ts` - Main configuration
2. `e2e/global-setup.ts` - Environment setup
3. `e2e/global-teardown.ts` - Cleanup

### Page Objects (6 files)
4. `e2e/pages/base.page.ts`
5. `e2e/pages/login.page.ts`
6. `e2e/pages/register.page.ts`
7. `e2e/pages/recipes.page.ts`
8. `e2e/pages/create-recipe.page.ts`
9. `e2e/pages/recipe-detail.page.ts`

### Fixtures & Utilities (5 files)
10. `e2e/fixtures/auth.fixture.ts`
11. `e2e/utils/api.ts`
12. `e2e/utils/test-data.ts`

### Test Files (11 files)
13. `e2e/tests/auth/register.spec.ts`
14. `e2e/tests/auth/login.spec.ts`
15. `e2e/tests/auth/logout.spec.ts`
16. `e2e/tests/recipes/create.spec.ts`
17. `e2e/tests/recipes/list.spec.ts`
18. `e2e/tests/recipes/detail.spec.ts`
19. `e2e/tests/recipes/edit.spec.ts`
20. `e2e/tests/recipes/delete.spec.ts`
21. `e2e/tests/workflows/complete-recipe-journey.spec.ts`
22. `e2e/tests/errors/network-errors.spec.ts`
23. `e2e/tests/errors/validation-errors.spec.ts`

### CI/CD & Docs (3 files)
24. `.github/workflows/e2e-tests.yml`
25. `docs/E2E_TESTING.md`
26. Updates to `README.md`, `docs/TESTING.md`

**Total**: ~35 files

---

## Expected Test Coverage

### Test Scenarios
- **Authentication**: 8 tests (register, login, logout, persistence)
- **Recipe CRUD**: 15 tests (create, list, detail, edit, delete)
- **Workflows**: 1 comprehensive journey test
- **Error Handling**: 5 tests (network, validation)
- **Total**: ~25-30 unique tests

### Browser Coverage
- Chrome (Chromium)
- Firefox
- Safari (WebKit)

### Total Executions per Run
~75-90 test runs (25-30 tests × 3 browsers)

---

## What These Tests Will Catch

✅ **Server Startup Issues**
- Backend fails to start
- CORS configuration errors
- Missing environment variables
- Database connection failures

✅ **API Integration Issues**
- Frontend-backend contract mismatches
- Response parsing errors
- Authentication flow problems
- JWT token handling

✅ **Database State Issues**
- Data persistence failures
- Transaction conflicts
- Migration problems
- Concurrent access issues

✅ **User Workflow Issues**
- Multi-step process breaking
- Navigation errors
- State management bugs
- Page refresh issues

✅ **Browser-Specific Issues**
- JavaScript errors
- CSS rendering problems
- Cross-browser compatibility

---

## Running Tests

### Locally
```bash
# Run all E2E tests
npm run test:e2e

# Run in headed mode (see browser)
npm run test:e2e:headed

# Run specific test file
npx playwright test e2e/tests/auth/login.spec.ts

# Debug mode
npm run test:e2e:debug

# Open test report
npx playwright show-report
```

### In CI/CD
Tests run automatically on every PR to main/develop branches.

---

## Success Criteria

✅ All E2E tests passing in CI/CD
✅ Tests catch real integration issues (server, API, database)
✅ Test execution time < 5 minutes
✅ Flaky test rate < 5%
✅ Coverage of all critical user paths
✅ Clear error messages and debugging artifacts

---

## Next Steps After Implementation

1. **Monitor Test Stability** - Track flaky tests, fix timing issues
2. **Expand Coverage** - Add library/sharing tests when UI is implemented
3. **Performance Testing** - Add load tests for high-traffic scenarios
4. **Visual Regression** - Consider Percy/Chromatic for UI changes
5. **Accessibility** - Integrate axe-core for A11y testing


## Execution Summary

- **Total:** 10
- **Completed:** 10
- **In Progress:** 0
- **Pending:** 0
