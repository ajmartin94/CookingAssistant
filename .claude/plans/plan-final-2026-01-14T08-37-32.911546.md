# Plan (FINAL)

**Timestamp:** 2026-01-14T08:37:32.911546

# Plan: Fix Test Failures and Close Stale Issues

## Summary

There are **28 failing frontend tests** and **4 skipped backend tests** caused by:
1. **Uncommitted component changes** that improved code but tests weren't updated to match
2. **Backend Share API tests using wrong URLs** - endpoints exist but tests expect different paths

Additionally, **3 of 4 beads issues are already complete** and should be closed.

---

## Current State

### Backend: 150 passed, 4 skipped
| Test | Expected URL | Actual URL | Status |
|------|-------------|------------|--------|
| `test_list_user_shares` | GET `/api/v1/shares` | GET `/api/v1/shares/my-shares` | URL mismatch |
| `test_list_received_shares` | GET `/api/v1/shares/with-me` | GET `/api/v1/shares/shared-with-me` | URL mismatch |
| `test_get_shared_resource` | GET `/api/v1/shares/{token}` | GET `/api/v1/shares/token/{token}/recipe` | URL mismatch |
| `test_get_shared_resource_invalid_token` | GET `/api/v1/shares/{token}` | GET `/api/v1/shares/token/{token}/recipe` | URL mismatch |

### Frontend: 177 passed, 28 failed

**Root cause**: Uncommitted changes improved components but tests weren't updated:

| File | Changes Made | Test Impact |
|------|-------------|-------------|
| `LoginPage.tsx` | Button text: "Sign In"/"Sign Up" → "Login"/"Register" | 10 tests fail expecting old text |
| `RecipeForm.tsx` | Cuisine: text input → select dropdown | 12 tests fail expecting text input |
| `RecipesPage.tsx` | Button → Link for navigation | 3 tests fail looking for buttons |
| `RecipeDetailPage.tsx` | Added data-testid attributes | 1 test timing issue |
| `RecipeCard.tsx` | Added data-testid attribute | No failures |

### Beads Issues Status
| Issue ID | Description | Actual Status |
|----------|-------------|---------------|
| CookingAssistant-62e (P2) | Implement 4 Share API endpoints | Endpoints exist, tests need fixing |
| CookingAssistant-j69 (P3) | Backend E2E tests | Optional per description |
| CookingAssistant-aby (P3) | Frontend E2E tests | **DONE** - 11 E2E tests exist |
| CookingAssistant-4x3 (P3) | Coverage reporting | **DONE** - Already in CI/CD |

---

## Implementation Plan

### Phase 1: Fix Backend Share API Tests
**File**: `backend/tests/integration/test_sharing_api.py`

1. Update `test_list_user_shares`: Change URL from `/api/v1/shares` to `/api/v1/shares/my-shares`
2. Update `test_list_received_shares`: Change URL from `/api/v1/shares/with-me` to `/api/v1/shares/shared-with-me`
3. Update `test_get_shared_resource`: Change URL from `/api/v1/shares/{token}` to `/api/v1/shares/token/{token}/recipe`
4. Update `test_get_shared_resource_invalid_token`: Same URL fix
5. Remove `@pytest.mark.skip` decorators from all 4 tests

### Phase 2: Fix Frontend Tests

#### 2a. LoginPage.test.tsx (10 failures)
- Update assertions to look for "Login" instead of "Sign In"
- Update assertions to look for "Register" instead of "Sign Up"
- Update any input queries to use name attributes if needed

#### 2b. RecipeForm.test.tsx (12 failures)
- Update cuisine type tests to interact with select dropdown instead of text input
- Use `getByRole('combobox')` or `getByDisplayValue` for select
- Update validation tests to work with new select behavior

#### 2c. RecipesPage.test.tsx (3 failures)
- Update button queries to Link queries using `getByRole('link')`
- The "+ New Recipe" is now a Link, not a button

#### 2d. RecipeDetailPage.test.tsx (1 failure)
- Check if test needs timeout adjustment for data loading
- May just need waitFor timing fix

### Phase 3: Verify All Tests Pass
```bash
cd backend && python -m pytest tests/ -v
cd frontend && npm test -- --run
```

### Phase 4: Close Stale Beads Issues
1. Close CookingAssistant-aby: "Frontend E2E tests already exist (11 test files in e2e/tests/)"
2. Close CookingAssistant-4x3: "Coverage reporting already configured in CI/CD workflows"
3. Update/close CookingAssistant-62e after tests are fixed
4. Leave CookingAssistant-j69 open (optional work)

### Phase 5: Commit Changes
```bash
git add backend/tests/integration/test_sharing_api.py
git add frontend/src/**/*.test.tsx
git commit -m "fix(tests): update tests to match component improvements"
bd sync
git push
```

---

## Files to Modify

### Backend
- `backend/tests/integration/test_sharing_api.py` - Fix 4 test URLs

### Frontend Tests
- `frontend/src/pages/LoginPage.test.tsx` - Fix 10 tests
- `frontend/src/components/recipes/RecipeForm.test.tsx` - Fix 12 tests
- `frontend/src/pages/RecipesPage.test.tsx` - Fix 3 tests
- `frontend/src/pages/RecipeDetailPage.test.tsx` - Fix 1 test
- `frontend/src/pages/CreateRecipePage.test.tsx` - Fix 2 tests (uses RecipeForm)

---

## Verification

1. Run backend tests: `cd backend && python -m pytest tests/ -v` → All 154 pass
2. Run frontend tests: `cd frontend && npm test -- --run` → All 205 pass
3. Check beads: `bd ready` → Should show fewer open issues


## Execution Summary

- **Total:** 6
- **Completed:** 6
- **In Progress:** 0
- **Pending:** 0
